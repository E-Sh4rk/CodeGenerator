<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ACE Generator Lib Tests</title>
    <script src="ace_lib.bc.js"></script>
    <script src="ace_prama.js"></script>
  </head>
  <body>
    <datalist id="pokemonlist"></datalist>
    <datalist id="objectlist"></datalist>
    <datalist id="attacklist"></datalist>

    <!-- Custom Mass Outbreaks -->

    <input type="checkbox" id="ace_cmo_emu" name="ace_cmo_emu">
    <label for="ace_cmo_emu">Sur emulateur (&lt; mGBA 0.9) ?</label><br>
    <input list="pokemonlist" id="ace_cmo_species" value="">
    <button data-source="ace_cmo_src" data-preprocess="ace_cmo_preprocess" data-target="ace_cmo" onclick='generate(this)'>Générer le code</button>    

    <p id="ace_cmo"></p>
    <pre id="ace_cmo_src" style="display:none;">
      @@ exit = "WhiteOutFRA"
      @@ filler1 = 0xB2AC00FF
      @@ filler2 = 0xB2ACFF00
      @@ filler3 = 0xBFFF0000
      @@ filler4 = 0xFF000000

      species = %SPECIES%
      inaccurate_emu = %EMU%

      @@

      sbc r12,pc, \{ inaccurate_emu ? 0xC0 : 0xC2 \}
      sbc r12,r12, 0xA100

      movs r11, 0xED0000
      bic r11,r11, 0xC00000 ; r11 = 0x2D0000
      adc r11,r11, \{ species & 0xFFFF \} ?

      str r11, [r12, 0xC00]!
    </pre>
    <script>
      function ace_cmo_preprocess(txt) {
        let species = document.getElementById("ace_cmo_species");
        let emu = document.getElementById("ace_cmo_emu");
        txt = txt.replace("%EMU%", emu.checked ? "1" : "0");
        return txt.replace("%SPECIES%", pokemon_identifier(species.value));
      }
    </script>

    <!-- Any Item -->

    <input type="checkbox" id="ace_item_emu" name="ace_item_emu">
    <label for="ace_item_emu">Sur emulateur (&lt; mGBA 0.9) ?</label><br>
    <input list="objectlist" id="ace_item_obj" value="">
    <button data-source="ace_item_src" data-preprocess="ace_item_preprocess" data-target="ace_item" onclick='generate(this)'>Générer le code</button>    

    <p id="ace_item"></p>
    <pre id="ace_item_src" style="display:none;">
      @@ exit = "WhiteOutFRA"
      @@ filler1 = 0xB2AC00FF
      @@ filler2 = 0xB2ACFF00
      @@ filler3 = 0xBFFF0000
      @@ filler4 = 0xFF000000

      obj = %OBJ%
      inaccurate_emu = %EMU%

      @@

      sbc r12,pc, \{ inaccurate_emu ? 0x2B : 0x2D \}
      sbc r12,r12,0xAD00
      movs r11, \{ obj & 0xFFFF \} ?
      strh r11, [r12]     %%  Store item index in lottery prize location
    </pre>
    <script>
      function ace_item_preprocess(txt) {
        let obj = document.getElementById("ace_item_obj");
        let emu = document.getElementById("ace_item_emu");
        txt = txt.replace("%EMU%", emu.checked ? "1" : "0");
        return txt.replace("%OBJ%", object_identifier(obj.value));
      }
    </script>

    <!-- Any Move -->

    <input type="checkbox" id="ace_move_emu" name="ace_move_emu">
    <label for="ace_move_emu">Sur emulateur (&lt; mGBA 0.9) ?</label><br>
    <input list="attacklist" id="ace_move_attk" value="">
    <button data-source="ace_move_src" data-preprocess="ace_move_preprocess" data-target="ace_move" onclick='generate(this)'>Générer le code</button>    

    <p id="ace_move"></p>
    <pre id="ace_move_src" style="display:none;">
      @@ exit = "WhiteOutFRA"
      @@ filler1 = 0xB2AC00FF
      @@ filler2 = 0xB2ACFF00
      @@ filler3 = 0xBFFF0000
      @@ filler4 = 0xFF000000

      obj = %ATTK%
      inaccurate_emu = %EMU%

      @@

    </pre>
    <script>
      function ace_move_preprocess(txt) {
        let attk = document.getElementById("ace_move_attk");
        let emu = document.getElementById("ace_move_emu");
        txt = txt.replace("%EMU%", emu.checked ? "1" : "0");
        return txt.replace("%ATTK%", attack_identifier(attk.value));
      }
    </script>

    <!-- Generate species -->

    <input type="checkbox" id="ace_generate_emu" name="ace_generate_emu">
    <label for="ace_generate_emu">Sur emulateur (&lt; mGBA 0.9) ?</label><br>
    <input list="pokemonlist" id="ace_generate_species" value="">
    <button data-source="ace_generate_src" data-preprocess="ace_generate_preprocess" data-target="ace_generate" onclick='generate(this)'>Générer le code</button>

    <p id="ace_generate"></p>
    <pre id="ace_generate_src" style="display:none;">
      @@ title = "Create pokemon from nothing (FRA)"
      @@ author = "E-Sh4rk"
      @@ exit = "CertificateFullFRA"
      
      species = %SPECIES% ; Please set the species you want (it should not be 0)
      inaccurate_emu = %EMU% ; Set to 1 if you are using an innacurate emulator
      
      @@
      
      ; The Box 10 Slot 19 must be empty. A pokemon will appear there after execution of the code.
      
      sbc r11, r15, #0x2940          ; r11 = &Box10Slot19 + 9
      
      movs r12, \{ species & 0xFFFF \} ?
      strh r12, [r11, \{ 28-(inaccurate_emu?7:9) \}]!
      strh r12, [r11, 4]!
    </pre>
    <script>
      function ace_generate_preprocess(txt) {
        let species = document.getElementById("ace_generate_species");
        let emu = document.getElementById("ace_generate_emu");
        txt = txt.replace("%EMU%", emu.checked ? "1" : "0");
        return txt.replace("%SPECIES%", pokemon_identifier(species.value));
      }
    </script>
  </body>
</html>
